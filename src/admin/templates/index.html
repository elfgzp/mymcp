<!DOCTYPE html>
<html>
<head>
    <title>MyMCP Admin</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <h1>MyMCP 管理界面</h1>
        
        <div class="tabs">
            <button class="tab active" onclick="showTab('servers')">MCP 服务</button>
            <button class="tab" onclick="showTab('commands')">命令</button>
            <button class="tab" onclick="showTab('api')">API 文档</button>
        </div>
        
        <div id="servers" class="tab-content active">
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="refresh-btn" onclick="loadServers()">刷新</button>
                <button class="btn btn-primary" onclick="showAddServerModal()">添加 MCP 服务</button>
            </div>
            <div id="servers-list" class="loading">加载中...</div>
        </div>
        
        <div id="commands" class="tab-content">
            <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                <button class="refresh-btn" onclick="loadCommands()">刷新</button>
                <button class="btn btn-primary" onclick="showAddCommandModal()">添加命令</button>
            </div>
            <div id="commands-list" class="loading">加载中...</div>
        </div>
        
        <div id="api" class="tab-content">
            <h2>API 文档</h2>
            <p><a href="/docs" target="_blank">Swagger UI</a> | <a href="/redoc" target="_blank">ReDoc</a></p>
        </div>
    </div>
    
    <!-- 添加命令模态框 -->
    <div id="addCommandModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">添加命令</span>
                <span class="close" onclick="closeModal('addCommandModal')">&times;</span>
            </div>
            <form id="addCommandForm" onsubmit="handleAddCommand(event)">
                <div class="form-group">
                    <label class="form-label">命令名称 *</label>
                    <input type="text" class="form-input" name="name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">描述</label>
                    <textarea class="form-textarea" name="description"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">类型 *</label>
                    <select class="form-select" name="type" required onchange="toggleCommandType(this.value)">
                        <option value="">请选择</option>
                        <option value="http">HTTP 接口</option>
                        <option value="script">脚本</option>
                    </select>
                </div>
                <div id="httpConfig" style="display: none;">
                    <h3 style="margin: 15px 0 10px 0; font-size: 16px;">HTTP 配置</h3>
                    <div class="form-group">
                        <label class="form-label">请求方法</label>
                        <select class="form-select" name="http_method">
                            <option value="GET">GET</option>
                            <option value="POST">POST</option>
                            <option value="PUT">PUT</option>
                            <option value="DELETE">DELETE</option>
                            <option value="PATCH">PATCH</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">URL *</label>
                        <input type="text" class="form-input" name="http_url" placeholder="https://api.example.com/endpoint">
                    </div>
                    <div class="form-group">
                        <label class="form-label">鉴权配置（可选）</label>
                        <select class="form-select" name="http_auth_ref" id="http_auth_ref">
                            <option value="">无</option>
                        </select>
                        <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                            选择已配置的鉴权方式，如 API Key、Bearer Token、自定义请求头等
                        </small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">自定义请求头（可选）</label>
                        <textarea class="form-textarea" name="http_headers" placeholder="每行一个，格式：Header-Name: header-value&#10;例如：&#10;User-Agent: MyApp/1.0&#10;X-Custom-Header: custom-value" style="min-height: 100px;"></textarea>
                        <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                            每行一个请求头，格式：Header-Name: header-value
                        </small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">URL 参数（可选）</label>
                        <textarea class="form-textarea" name="http_params" placeholder="每行一个，格式：param_name: param_value&#10;支持变量，如：city: '{city}'" style="min-height: 80px;"></textarea>
                        <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                            每行一个参数，格式：param_name: param_value，支持变量如 {city}
                        </small>
                    </div>
                    <div class="form-group">
                        <label class="form-label">请求体（可选，仅 POST/PUT/PATCH）</label>
                        <textarea class="form-textarea" name="http_body" placeholder='JSON 格式，例如：{"key": "value"}' style="min-height: 80px;"></textarea>
                        <small style="color: #666; font-size: 12px; display: block; margin-top: 5px;">
                            JSON 格式的请求体，支持变量如 {"city": "{city}"}
                        </small>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">超时时间（秒）</label>
                            <input type="number" class="form-input" name="http_timeout" value="30">
                        </div>
                        <div class="form-group">
                            <label class="form-label">响应格式</label>
                            <select class="form-select" name="http_response_format">
                                <option value="json">JSON</option>
                                <option value="text">Text</option>
                                <option value="xml">XML</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="scriptConfig" style="display: none;">
                    <h3 style="margin: 15px 0 10px 0; font-size: 16px;">脚本配置</h3>
                    <div class="form-group">
                        <label class="form-label">解释器</label>
                        <select class="form-select" name="script_interpreter">
                            <option value="python3">Python 3</option>
                            <option value="bash">Bash</option>
                            <option value="node">Node.js</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">脚本路径 *</label>
                        <input type="text" class="form-input" name="script_path" placeholder="./scripts/example.py">
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" class="form-checkbox" name="enabled" checked>
                        启用
                    </label>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="btn btn-primary">添加</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addCommandModal')">取消</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- 添加 MCP 服务模态框 -->
    <div id="addServerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <span class="modal-title">添加 MCP 服务</span>
                <span class="close" onclick="closeModal('addServerModal')">&times;</span>
            </div>
            <form id="addServerForm" onsubmit="handleAddServer(event)">
                <div class="form-group">
                    <label class="form-label">服务名称 *</label>
                    <input type="text" class="form-input" name="name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">描述</label>
                    <textarea class="form-textarea" name="description"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">连接类型 *</label>
                    <select class="form-select" name="connection_type" required onchange="toggleConnectionType(this.value)">
                        <option value="">请选择</option>
                        <option value="stdio">stdio</option>
                        <option value="sse">SSE</option>
                        <option value="websocket">WebSocket</option>
                    </select>
                </div>
                <div id="stdioConfig" style="display: none;">
                    <h3 style="margin: 15px 0 10px 0; font-size: 16px;">stdio 配置</h3>
                    <div class="form-group">
                        <label class="form-label">命令 *</label>
                        <input type="text" class="form-input" name="stdio_command" placeholder="uvx" value="uvx">
                    </div>
                    <div class="form-group">
                        <label class="form-label">参数（每行一个）</label>
                        <textarea class="form-textarea" name="stdio_args" placeholder="mcp-server-filesystem"></textarea>
                    </div>
                </div>
                <div id="sseConfig" style="display: none;">
                    <h3 style="margin: 15px 0 10px 0; font-size: 16px;">SSE 配置</h3>
                    <div class="form-group">
                        <label class="form-label">URL *</label>
                        <input type="text" class="form-input" name="sse_url" placeholder="https://example.com/mcp/sse">
                    </div>
                </div>
                <div id="websocketConfig" style="display: none;">
                    <h3 style="margin: 15px 0 10px 0; font-size: 16px;">WebSocket 配置</h3>
                    <div class="form-group">
                        <label class="form-label">URL *</label>
                        <input type="text" class="form-input" name="websocket_url" placeholder="ws://example.com/mcp/ws">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">前缀（可选）</label>
                    <input type="text" class="form-input" name="prefix" placeholder="fs">
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">超时时间（秒）</label>
                        <input type="number" class="form-input" name="timeout" value="30">
                    </div>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" class="form-checkbox" name="enabled" checked>
                        启用
                    </label>
                </div>
                <div class="action-buttons">
                    <button type="submit" class="btn btn-primary">添加</button>
                    <button type="button" class="btn btn-secondary" onclick="closeModal('addServerModal')">取消</button>
                </div>
            </form>
        </div>
    </div>
    
    <script src="/static/js/utils.js"></script>
    <script src="/static/js/servers.js"></script>
    <script src="/static/js/commands.js"></script>
    <script src="/static/js/modals.js"></script>
    <script src="/static/js/main.js"></script>
</body>
</html>
